{
  "version": 3,
  "sources": ["../node_modules/@mwcz/pbp-loading/dist/pbp-loading.js", "../rtw-timer.js", "../rtw-render.js"],
  "sourcesContent": ["var a=class extends HTMLElement{constructor(){super();this.attachShadow({mode:\"open\"})}play(){this.style.setProperty(\"--play-state\",\"running\")}pause(){this.style.setProperty(\"--play-state\",\"paused\")}connectedCallback(){let n=this.hasAttribute(\"paused\"),t=+this.getAttribute(\"box-count\")||4,e=+this.getAttribute(\"duration\")||Math.sqrt(t/4),s=new Array(t).fill(),o=e/(t*.7),i=100*o,p=`\n            content: \"\";\n            position: absolute;\n            display: block;\n            top: 0;\n            right: 0;\n            bottom: 0;\n            left: 0;\n            border: var(--pbp-loading-border, 1px solid white);\n            border-width: $WIDTH;\n            animation: $DIM ${e}s backwards alternate infinite;\n            animation-delay: var(--delay);\n            animation-play-state: var(--play-state);\n        `;this.shadowRoot.innerHTML=`\n            <style>\n                :host {\n                    display: inline-block;\n                    --play-state: ${n?\"paused\":\"running\"};\n                }\n                div {\n                    display: grid;\n                    grid-template-columns: ${s.map(()=>\"1fr\").join(\" \")};\n                    grid-gap: var(--pbp-loading-gap, 8px);\n                }\n                span {\n                    display: inline-block;\n                    position: relative;\n                    height: var(--pbp-loading-box-size, 20px);\n                    width: var(--pbp-loading-box-size, 20px);\n                }\n                @keyframes x {\n                  0% {\n                      transform: scaleX(var(--pbp-loading-grow, 150%));\n                      opacity: 0;\n                  }\n                  ${i}% {\n                      transform: scaleX(100%);\n                      opacity: 1;\n                  }\n                }\n                @keyframes y {\n                  0% {\n                      transform: scaleY(var(--pbp-loading-grow, 150%));\n                      opacity: 0;\n                  }\n                  ${i}% {\n                      transform: scaleY(100%);\n                      opacity: 1;\n                  }\n                }\n                span::before {\n                    ${p.replace(\"$WIDTH\",\"1px 0 1px 0\").replace(\"$DIM\",\"y\")}\n                }\n                span::after {\n                    ${p.replace(\"$WIDTH\",\"0 1px 0 1px\").replace(\"$DIM\",\"x\")}\n                }\n                */\n            </style>\n            <div>\n                ${s.map((d,r)=>`<span style=\"--delay:${r*o}s\"></span>`).join(\"\")}\n            </div>\n        `}};customElements.define(\"pbp-loading\",a);export{a as default};\n", "import \"@mwcz/pbp-loading\";\n\nexport default class Timer extends HTMLElement {\n    constructor() {\n        super();\n        this.attachShadow({ mode: \"open\" });\n\n        this.active = false;\n        this.paused = false;\n\n        this.step = this.step.bind(this);\n    }\n\n    connectedCallback() {\n        this.shadowRoot.innerHTML = `\n        <style>\n            pbp-loading {\n                width: 100%;\n            }\n            label {\n                display: grid;\n                grid-template-columns: 1fr;\n                grid-gap: 6px;\n            }\n        </style>\n        <label>\n            <pbp-loading paused duration=0.8 box-count=8></pbp-loading>\n            <span id=\"label-text\">&nbsp;</span>\n        </label>\n        `;\n\n        this.labelText = this.shadowRoot.querySelector(\"#label-text\");\n        this.loading = this.shadowRoot.querySelector(\"pbp-loading\");\n        console.log(\"loading\", this.loading);\n    }\n\n    resetSpinner() {\n        this.loading.style.removeProperty(\"--play-state\");\n        this.labelText.parentNode.removeChild(this.loading);\n        this.labelText.parentNode.insertBefore(this.loading, this.labelText);\n    }\n\n    start() {\n        if (!this.paused) {\n            this.startTime = performance.now();\n        } else {\n            this.paused = false;\n        }\n        this.active = true;\n        this.loading.play();\n        requestAnimationFrame(this.step);\n    }\n\n    pause() {\n        this.paused = true;\n        this.loading.pause();\n    }\n\n    step() {\n        if (this.active && !this.paused) {\n            this._updateLabel();\n            requestAnimationFrame(this.step);\n        }\n    }\n\n    _updateLabel() {\n        const diff = performance.now() - this.startTime;\n        this.setLabel(`${diff.toFixed(1)}ms`);\n    }\n\n    stop() {\n        this.resetSpinner();\n        this._updateLabel();\n        this.active = false;\n    }\n\n    setLabel(msg) {\n        this.labelText.innerText = msg;\n    }\n}\ncustomElements.define(\"rtw-timer\", Timer);\n", "import \"./rtw-timer.js\";\n\nexport default class RtwRender extends HTMLElement {\n    constructor() {\n        super();\n        this.attachShadow({ mode: \"open\" });\n        fetch(`${import.meta.url}/../wasm_bg.wasm`);\n        this.shadowRoot.innerHTML = `\n            <style>\n                :host {\n                    display: inline-block;\n                    background-color: var(--rtw-background-color, black);\n                    padding: 14px;\n                }\n                canvas {\n                    width: 100%;\n                    image-rendering: -moz-crisp-edges;\n                    image-rendering: -webkit-crisp-edges;\n                    image-rendering: pixelated;\n                    image-rendering: crisp-edges;\n                }\n                .controls {\n                    margin-top: 8px;\n                    width: 100%;\n                    display: grid;\n                    grid-template-columns: 1fr 1fr;\n                    grid-gap: 14px;\n                }\n                button {\n                    border: var(--rtw-button-border, 1px solid white);\n                    background: var(--rtw-button-background, black);\n                    color: var(--rtw-button-color, white);\n                }\n                button:hover {\n                    background: var(--rtw-button-background-hover, #1f1f1f);\n                }\n                button:active, button:focus {\n                    background: var(--rtw-button-background-active, #3f3f3f);\n                }\n            </style>\n\n            <canvas width=\"500\" height=\"333\"></canvas>\n            <div class=\"controls\">\n                <button disabled>Render</button>\n                <rtw-timer></rtw-timer>\n            </div>\n        `;\n    }\n\n    connectedCallback() {\n        this.btn = this.shadowRoot.querySelector(\"button\");\n        this.canvas = this.shadowRoot.querySelector(\"canvas\");\n        this.timer = this.shadowRoot.querySelector(\"rtw-timer\");\n\n        this.ctx = this.canvas.getContext(\"2d\");\n        this.moduleWorkerSupported = true;\n\n        this.worker = this.createWorker();\n\n        this.wasmInit = null;\n        this.wasmRender = null;\n\n        this.btn.addEventListener(\"click\", () => {\n            this.preRender();\n            this.render();\n        });\n    }\n\n    createWorker() {\n        const workerUrl = new URL(`${import.meta.url}/../wasm-worker.js`);\n        const worker = new Worker(workerUrl.href, { type: \"module\" });\n        worker.addEventListener(\"message\", async (e) => {\n            if (e.data.status === \"success\") {\n                if (e.data.data.imageData) {\n                    this.postRender(e.data.data.imageData);\n                } else if (e.data.data.initialized) {\n                    this.btn.disabled = false;\n                }\n            } else if (e.data.status === \"error\") {\n                console.log(`web worker error type: ${e.data.data.type}`);\n                if (e.data.data.type === \"import\") {\n                    // switch to main thread mode\n                    this.moduleWorkerSupported = false;\n                    // enable the render button\n                    this.btn.disabled = false;\n\n                    // initialize wasm\n                    const wasmModule = await import(\"./wasm-render.js\");\n                    this.wasmInit = wasmModule.wasmInit;\n                    this.wasmRender = wasmModule.wasmRender;\n                    await wasmInit();\n\n                    this.timer.pause();\n                    this.timer.setLabel(\n                        \"Module worker not supported in this browser; running on the main thread (expect lockup during render).\"\n                    );\n                }\n                if (e.data.data.type === \"render\") {\n                    this.timer.pause();\n                    this.timer.setLabel(\n                        \"Error occurred in worker during rendering.\"\n                    );\n                }\n            }\n        });\n\n        worker.postMessage(\"init\");\n        return worker;\n    }\n\n    /**\n     * Begin the rendering, including starting a timer widget, starting render\n     * within the wasm module, and writing the render result into the canvas.\n     */\n    async preRender() {\n        // clearImage();\n        this.timer.start();\n        this.btn.disabled = true;\n    }\n\n    async render() {\n        console.log(\n            `starting render ${\n                [\"ON\", \"OFF\"][~~this.moduleWorkerSupported]\n            } the main thread`\n        );\n        if (this.moduleWorkerSupported) {\n            this.worker.postMessage(\"render\");\n        } else {\n            this.postRender(await this.wasmRender());\n        }\n    }\n    postRender(imageData) {\n        console.time(\"drawing canvas\");\n        this.ctx.putImageData(imageData, 0, 0);\n        console.timeEnd(\"drawing canvas\");\n        this.timer.step();\n        this.timer.stop();\n        this.btn.innerText = \"Re-render\";\n        this.btn.disabled = false;\n    }\n}\n\ncustomElements.define(\"rtw-render\", RtwRender);\n"],
  "mappings": "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",
  "names": []
}
