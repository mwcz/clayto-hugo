<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
  
  <meta property="og:title" content="Opcode patterns 70% finished" />
  <meta name="twitter:title" content="Opcode patterns 70% finished" />
  
  <title>Opcode patterns 70% finished - clayto</title>

  
  <meta name="description" content="Creative coding and web stuff.">
  <meta property="og:description" content="Creative coding and web stuff.">
  <meta name="twitter:description" content="Creative coding and web stuff.">
  

  <meta name="author" content=""/>
  <meta property="og:site_name" content="clayto" />
  <meta property="og:url" content="https://clayto.com/2011/10/opcode-patterns-70-finished/" />

  
  <meta property="og:image" content="https://clayto.com/2011/10/opcode-patterns-70-finished/thumb.jpg" />
  <meta name="twitter:image" content="https://clayto.com/2011/10/opcode-patterns-70-finished/thumb.jpg" />
  
  <meta name="twitter:card" content="summary" />

  
  <meta name="twitter:site" content="@mwcz" />
  <meta name="twitter:creator" content="@mwcz" />
  

  
  <meta property="og:type" content="article" />
  
  
  
  <meta name="generator" content="Hugo 0.50" /><link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600" rel="stylesheet">
  <link rel="stylesheet" href="https://clayto.com/css/styles.min.css" />

  
  <link rel="apple-touch-icon" sizes="180x180" href="https://clayto.com/images/favicons/apple-touch-icon.png?v=Lby0POEbX9">
  <link rel="icon" type="image/png" sizes="32x32" href="https://clayto.com/images/favicons/favicon-32x32.png?v=Lby0POEbX9">
  <link rel="icon" type="image/png" sizes="16x16" href="https://clayto.com/images/favicons/favicon-16x16.png?v=Lby0POEbX9">
  <link rel="manifest" href="https://clayto.com/images/favicons/site.webmanifest?v=Lby0POEbX9">
  <link rel="mask-icon" href="https://clayto.com/images/favicons/safari-pinned-tab.svg?v=Lby0POEbX9" color="#121212">
  <link rel="shortcut icon" href="https://clayto.com/images/favicons/favicon.ico?v=Lby0POEbX9">
  <meta name="msapplication-TileColor" content="#121212">
  <meta name="msapplication-config" content="/images/favicons/browserconfig.xml?v=Lby0POEbX9">
  <meta name="theme-color" content="#121212">
  

  
  
  

</head>

<body>
  
  
  
  
  
  
  
  
  
  
  
  
<header class="pbp-navbar-container">
  
<nav class="pbp-navbar" role="navigation">
  <div class="pbp-nav-description">
    WEB, DEMOSCENE, GAMEDEV.&nbsp;&nbsp;
  </div>
  <div class="pbp-nav-logo">
    <a href="https://clayto.com/" title="https://clayto.com/ homepage" id="pbp-logo">
      <img src="https://clayto.com/images/logo.png">
    </a>
  </div>
  <div class="pbp-navitems">
    
    
    
    <a href="https://clayto.com/" class="pbp-navitem">
      &nbsp;BLOG</a>
    
    &nbsp;<span class="pbp-nav-separator">&middot;</span>
    
    
    <a href="https://clayto.com/demos" class="pbp-navitem">
      &nbsp;DEMOS</a>
    
    &nbsp;<span class="pbp-nav-separator">&middot;</span>
    
    
    <a href="https://clayto.com/games" class="pbp-navitem">
      &nbsp;GAMES</a>
    
    
  </div>
</nav>




</header>
  <main id="main" role="main" class="container">


<article class="pbp-article">

    <div class="pbp-article-meta">
        <time datetime="2011-10-13T00:00:00Z">
          Oct 13, 2011
        </time>
        <span class="pbp-blue">&middot;</span>
        1 minute read
        <br>
      <span class="pbp-article-tags">
        
        <a href="https://clayto.com/tags/aejs" class="c-tag">#aejs</a>
        
        <a href="https://clayto.com/tags/html5" class="c-tag">#html5</a>
        
        <a href="https://clayto.com/tags/javascript" class="c-tag">#javascript</a>
        
        <a href="https://clayto.com/tags/amiga" class="c-tag">#amiga</a>
        
        <a href="https://clayto.com/tags/web" class="c-tag">#web</a>
        
      </span>
    </div>

  <header>
    <h1>Opcode patterns 70% finished</h1>
  </header>
  
  
  <section>
    <p>genlut.py is really filling out. It generates the LUT for all 68k opcodes (68000 only), and I&rsquo;m about 70% done. 77 down, 34 to go.</p>

<p>The OPCODES dict defines the first two bytes of each opcode, both static bits and operands. The operand strings act as keys into the PATTERNS struct, which contains all possible values for each operand.</p>

<p>The recursive function gen() is fed an opcode pattern which may contain operand strings as well as static bits. Some operand patterns contain other operand patterns, so gen() keeps recursing until all operand patterns are gone. Once a set of totally static bits has been created, those bits are added to INSTRUCTIONS, along with the name of the opcode.</p>

<p>The PATTERNS, OPCODES, and INSTRUCTIONS dicts are all named poorly, and the whole solution isn&rsquo;t ultra-elegant, but it does follow the structure of the 68k PRM pretty intuitively and is easy to edit. Once it&rsquo;s complete, I should never need to run it again.</p>

<p>(This post was copied from my old <a href="http://aejs.blogspot.com/">AEJS blog</a>)</p>

  </section>
  <footer>

    

    

    

<section>
  <h3>RELATED POSTS</h3>
  <div class="pbp-related">
    
    <article class="pbp-article-li vertical">
  <h2 class="pbp-article-title"><a href="https://clayto.com/2011/09/lut/">LUT</a></h2>
  <div class="pbp-article-summary">
    <section>
      
        Decoding is easy. Decoding requires a lot of typing. (I am starting to believe this is true of ever aspect of interpreted emulation&hellip;)
For the AEJS decoder, I am creating a look-up table with every possible pattern for each instruction. It was my first idea, but I initially discarded it as &ldquo;wasteful and inelegant&rdquo;. Later, I accepted it as &ldquo;really fast&rdquo;.
I&rsquo;m generating a large set of bit patterns that map to 68k opcodes, like so:
      
    </section>
  </div>
  <div class="pbp-article-meta">
    <time datetime="2011-09-22T00:00:00Z">
      Sep 22, 2011
    </time>
  </div>
  
  <a tabindex="-1" class="pbp-article-thumbnail" href="https://clayto.com/2011/09/lut/">
    <div class="pbp-article-thumbnail">
      <div class="glass-card">
        <div class="glass-card-ratio">
          <img class="glass-card-bg glass-card-bg-default" src="https://clayto.com/2011/09/lut//thumb.jpg">
          <div class="glass-card-border-outer"></div>
          <div class="glass-card-border-inner"></div>
          
          
          
          
          
        </div>
      </div>
    </div>
  </a>
  
</article>

    
    
    <article class="pbp-article-li vertical">
  <h2 class="pbp-article-title"><a href="https://clayto.com/2011/09/introducing-aejs/">Introducing AEJS</a></h2>
  <div class="pbp-article-summary">
    <section>
      
        Introducing AEJS, an Amiga emulator written in JavaScript. Wait, wording it like that makes it sound like it&rsquo;s finished. It isn&rsquo;t. It won&rsquo;t be for a long time. AEJS is just a hobby, and will never hold a candle to UAE.
Why the Amiga? Given that this is my first emulator, it would have been much easier to go with a 6502 or 8080 instead, but I didn&rsquo;t grow up with those; I grew up with a 68k powering an Amiga 500.
      
    </section>
  </div>
  <div class="pbp-article-meta">
    <time datetime="2011-09-20T00:00:00Z">
      Sep 20, 2011
    </time>
  </div>
  
  <a tabindex="-1" class="pbp-article-thumbnail" href="https://clayto.com/2011/09/introducing-aejs/">
    <div class="pbp-article-thumbnail">
      <div class="glass-card">
        <div class="glass-card-ratio">
          <img class="glass-card-bg glass-card-bg-default" src="https://clayto.com/2011/09/introducing-aejs//thumb.jpg">
          <div class="glass-card-border-outer"></div>
          <div class="glass-card-border-inner"></div>
          
          
          
          
          
        </div>
      </div>
    </div>
  </a>
  
</article>

    
    
    <article class="pbp-article-li vertical">
  <h2 class="pbp-article-title"><a href="https://clayto.com/projects/aejs/">AEJS</a></h2>
  <div class="pbp-article-summary">
    <section>
      
        AEJS was an experimental Amiga 500 emulator written in JavaScript. The name stands for Amiga Emulator JavaScript and is pronounced &ldquo;aegis&rdquo;.
 My motivation to build AEJS came from these sources:
 The HTML5 era introduced new APIs which finally made it possible: Typed arrays, Web Audio, File, Canvas, Fullscreen, Gamepad Fabrice Bellard&rsquo;s JavaScript PC emulator JavaScript performance was finally good enough to make it feasible It bridged front-end web development with low-level machine code, both of which are super awesome I still have the Amiga 500 I played with obsessively since 3 years-old The 68000 is legendary and I wanted to find out why  I stopped development for these reasons:
      
    </section>
  </div>
  <div class="pbp-article-meta">
    <time datetime="2011-10-13T00:00:00Z">
      Oct 13, 2011
    </time>
  </div>
  
  <a tabindex="-1" class="pbp-article-thumbnail" href="https://clayto.com/projects/aejs/">
    <div class="pbp-article-thumbnail">
      <div class="glass-card">
        <div class="glass-card-ratio">
          <img class="glass-card-bg glass-card-bg-default" src="https://clayto.com/projects/aejs//./icon_aejs.jpg">
          <div class="glass-card-border-outer"></div>
          <div class="glass-card-border-inner"></div>
          
          
          
          
          
        </div>
      </div>
    </div>
  </a>
  
</article>

    
    
    <article class="pbp-article-li vertical">
  <h2 class="pbp-article-title"><a href="https://clayto.com/projects/jsimage/">JSImage</a></h2>
  <div class="pbp-article-summary">
    <section>
      
        JSImage was a basic, buggy, just-for-fun image processing library that I wrote in 2008&frasl;2009 when I first started seriously studying JavaScript.
A stumbled across a book in my university library, and started implementing the algorithms on the newly available HTML5 canvas element.
I&rsquo;ve made several posts about JSImage which contain live demos.
I think I put more work into code formatting than correct output. ;)
      
    </section>
  </div>
  <div class="pbp-article-meta">
    <time datetime="2009-01-01T00:00:00Z">
      Jan 1, 2009
    </time>
  </div>
  
  <a tabindex="-1" class="pbp-article-thumbnail" href="https://clayto.com/projects/jsimage/">
    <div class="pbp-article-thumbnail">
      <div class="glass-card">
        <div class="glass-card-ratio">
          <img class="glass-card-bg glass-card-bg-default" src="https://clayto.com/projects/jsimage//./icon_jsimage.jpg">
          <div class="glass-card-border-outer"></div>
          <div class="glass-card-border-inner"></div>
          
          
          
          
          
        </div>
      </div>
    </div>
  </a>
  
</article>

    
    
    <article class="pbp-article-li vertical">
  <h2 class="pbp-article-title"><a href="https://clayto.com/projects/mediancut/">median-cut.js</a></h2>
  <div class="pbp-article-summary">
    <section>
      
        The unfortunately-named median-cut.js is the library that powers ColorPal&rsquo;s palette generation.
I say it&rsquo;s unfortunately named because it doesn&rsquo;t implement a pure median-cut algorithm. It&rsquo;s identical, except that instead of cutting boxes at their median, they are instead cut at the mean. This results in more pleasing color palettes in most cases.
Here&rsquo;s a comparison:
If you&rsquo;re interested in median-cut vs mean-cut, see this post for a technical discussion.
The code is available on GitHub.
      
    </section>
  </div>
  <div class="pbp-article-meta">
    <time datetime="2009-01-01T00:00:00Z">
      Jan 1, 2009
    </time>
  </div>
  
  <a tabindex="-1" class="pbp-article-thumbnail" href="https://clayto.com/projects/mediancut/">
    <div class="pbp-article-thumbnail">
      <div class="glass-card">
        <div class="glass-card-ratio">
          <img class="glass-card-bg glass-card-bg-default" src="https://clayto.com/projects/mediancut//./median-mean-comparison.png">
          <div class="glass-card-border-outer"></div>
          <div class="glass-card-border-inner"></div>
          
          
          
          
          
        </div>
      </div>
    </div>
  </a>
  
</article>

    
    
  </div>
</section>




  </footer>
</article>
  </main>
  <footer class="container">
    <section class="pbp-footer">
      
<aside>
  
    <small class="footer-label">CONTACT ME</small>
    
    
    
    
<ul class="pbp-social-links">
  
  <li>
    <a title="Email me" href="mailto:mwc@clayto.com">
      <span class="icon-mail"></span>
    </a>
  </li>
  
  
  <li>
    <a title="my GitHub activity" href="https://github.com/mwcz" target="_blank">
      <span class="icon-github-squared"></span>
    </a>
  </li>
  
  
  <li>
    <a title="my CodePens" href="https://codepen.io/mwcz" target="_blank">
      <span class="icon-codepen"></span>
    </a>
  </li>
  
  
  <li>
    <a title="my Twitter" href="https://twitter.com/mwcz" target="_blank">
      <span class="icon-twitter-squared"></span>
    </a>
  </li>
  
  
  
  
  
  
  
  
  
  
  
  
  <li>
    <a title="my Vimeo videos" href="https://vimeo.com/mwcz" target="_blank">
      <span class="icon-vimeo-squared"></span>
    </a>
  </li>
  
  
  
</ul>


  
</aside>


    </section>

    
    
    
    
    

    
    
    
    
    
    
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.1.1/anchor.min.js"></script>
  <script>
    anchors.options.visible = 'touch';
    anchors.options.placement = 'right';
    anchors.options.class = 'heading-anchor';
    anchors.add('article > section h1,article > section h2,article > section h3,article > section h4,article > section h5,article > section h6');
  </script>

  
    
  

</body>
</html>

