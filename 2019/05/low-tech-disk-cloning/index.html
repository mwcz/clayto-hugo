<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0"
  />
  
  <meta property="og:title" content="Low-tech Disk Cloning" />
  <meta name="twitter:title" content="Low-tech Disk Cloning" />
  
  <title>Low-tech Disk Cloning - clayto</title>

  
  <meta name="description" content="Using dd and netcat to clone a disk over your local network." />
  <meta property="og:description" content="Using dd and netcat to clone a disk over your local network." />
  <meta name="twitter:description" content="Using dd and netcat to clone a disk over your local network." />
  

  <meta name="author" content="" />
  <meta property="og:site_name" content="clayto" />
  <meta property="og:url" content="https://clayto.com/2019/05/low-tech-disk-cloning/" />

  
  <meta property="og:image" content="https://clayto.com/2019/05/low-tech-disk-cloning/thumb.jpg" />
  <meta
    name="twitter:image"
    content="https://clayto.com/2019/05/low-tech-disk-cloning/thumb.jpg"
  />
  
  <meta name="twitter:card" content="summary" />

  
  <meta name="twitter:site" content="@mwcz" />
  <meta name="twitter:creator" content="@mwcz" />
   
  <meta property="og:type" content="article" />
   
  
  <meta name="generator" content="Hugo 0.81.0" /><link media="screen"
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600"
    rel="stylesheet"
  />
  <link media="screen" rel="stylesheet" href="https://clayto.com/css/styles.min.css" />

  
  <link
    rel="apple-touch-icon"
    sizes="180x180"
    href="https://clayto.com/images/favicons/apple-touch-icon.png?v=alQ2onMqbL"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="32x32"
    href="https://clayto.com/images/favicons/favicon-32x32.png?v=alQ2onMqbL"
  />
  <link
    rel="icon"
    type="image/png"
    sizes="16x16"
    href="https://clayto.com/images/favicons/favicon-16x16.png?v=alQ2onMqbL"
  />
  <link rel="manifest" href="https://clayto.com/images/favicons/site.webmanifest?v=alQ2onMqbL" />
  <link
    rel="mask-icon"
    href="https://clayto.com/images/favicons/safari-pinned-tab.svg?v=alQ2onMqbL"
    color="#121212"
  />
  <link rel="shortcut icon" href="https://clayto.com/images/favicons/favicon.ico?v=alQ2onMqbL" />
  <meta name="msapplication-TileColor" content="#121212" />
  <meta
    name="msapplication-config"
    content="/images/favicons/browserconfig.xml?v=alQ2onMqbL"
  />
  <meta name="theme-color" content="#121212" />
   
  
  

</head>

<body>
  
  
  
  
  
  
  
  
  
  
  
  
<header class="pbp-navbar-container">
  
<nav class="pbp-navbar" role="navigation">
  <div class="pbp-nav-description">
    WEB, DEMOS, GAMEDEV.&nbsp;&nbsp;
  </div>
  <div class="pbp-nav-logo">
    <a href="https://clayto.com/" title="https://clayto.com/ homepage" id="pbp-logo">
      <img src="https://clayto.com/images/logo.png">
    </a>
  </div>
  <div class="pbp-navitems">
    
    
    
    <a href="https://clayto.com/" class="pbp-navitem">
      &nbsp;BLOG</a>
    
    &nbsp;<span class="pbp-nav-separator">&middot;</span>
    
    
    <a href="https://clayto.com/demos" class="pbp-navitem">
      &nbsp;DEMOS</a>
    
    &nbsp;<span class="pbp-nav-separator">&middot;</span>
    
    
    <a href="https://clayto.com/games" class="pbp-navitem">
      &nbsp;GAMES</a>
    
    
  </div>
</nav>




</header>
  <main id="main" role="main" class="container">


<article class="pbp-article">

  <header>
    <h1>Low-tech Disk Cloning</h1>
  </header>

  

  <div class="pbp-article-meta">
    <time datetime="2019-05-31T14:17:57-04:00">
      May 31, 2019
    </time>
    
    <span class="pbp-blue">&middot;</span>
    4 minute read
    <br>
    <span class="pbp-article-tags">
      
      <a href="https://clayto.com/tags/linux" class="c-tag">#linux</a>
      
      <a href="https://clayto.com/tags/fedora" class="c-tag">#fedora</a>
      
    </span>
  </div>

  
  
  <section>
    <p>It&rsquo;s a tale as old as time.  A nice laptop.  A nearby cold beverage.  A sickening splash.  Thanks to the solid seals on the <a href="https://en.wikipedia.org/wiki/ThinkPad_X1_Carbon#2018_%E2%80%93_6th_generation">Carbon</a>, there was no permanent damage, just a very sticky, nearly unusable keyboard.  Rather than clean or replace the keyboard, our support desk opted to issue a new laptop.</p>
<p>That&rsquo;s how I found myself with two identical laptops, one whose SSD had a fully configured OS, and the other with an empty SSD in need of such an OS.</p>
<p><img src="./we-lenovo-thinkpad-x1-carbon-2017-feature1.webp" alt="image of two X1 Carbon laptops"></p>
<p>To get the source disk&rsquo;s data onto the destination disk as quickly as possible, I wanted to do a quick and dirty clone without having to learn how to use a new tool, without having to find a large disk to store an intermediary copy of the disk image, and without taking hours and hours to transfer.  With the help of a few StackOverflow posts, I settled on the following solution which makes use of two <a href="https://getfedora.org/">Fedora</a> live USB drives, <code>dd</code> and <code>netcat</code>.</p>
<hr>
<h2 id="step-0-preliminary-notes">Step 0. Preliminary notes</h2>
<p>The first thing to note is that this method is not secure (it&rsquo;s unencrypted) and is meant to be used on a private local network only.</p>
<p>These steps are unlikely to work if the hardware is not identical.  If the destination disk is even a little bit smaller, things are likely to fail catastrophically.  And if it&rsquo;s larger, you won&rsquo;t have access to that extra space unless you resize your partitions after the image is transferred.</p>
<p>I bear no responsibility for the outcome of these instructions.</p>
<p>I make mistakes.  Please read and understand the steps before running any of them.</p>
<p>I wrote this mostly as a note-to-self, but if it helps someone out, great!</p>
<p>One other thing before moving on. A wired network is <em>far superior</em> to wireless for what&rsquo;s coming next.</p>
<hr>
<h2 id="step-1-live-os-on-both-machines">Step 1. Live OS on both machines</h2>
<p>First, grab two USB thumb drives, <a href="https://docs.fedoraproject.org/en-US/fedora/f30/install-guide/install/Preparing_for_Installation/#sect-preparing-boot-media">put a Fedora live system</a> on them, and boot up both machines from the thumb drives.</p>
<p>Once Fedora live is booted up, open a terminal on each machine and run:</p>
<pre><code>sudo -i
</code></pre><p>Use these rooted terminals for all following steps.</p>
<p>Now that Fedora live is running on both machines, we&rsquo;ll set up the destination machine first.</p>
<hr>
<h2 id="step-2-prepare-the-destination-machine-to-receive-the-image">Step 2. Prepare the destination machine to receive the image</h2>
<p>On the destination machine, gather two pieces of information, the destination machine&rsquo;s IP and the path to the disk.</p>
<h3 id="the-destination-machines-wired-ip-address">The destination machine&rsquo;s <em>wired</em> IP address</h3>
<p>To find <em>wired</em> IP address, use either use <code>ip addr</code> or Settings / Network.  Once you find it, go to the <em>source machine</em> and run <code>export DEST_IP=&quot;1.2.3.4&quot;</code> but replace <code>1.2.3.4</code> with the IP you found.  Then go back to the destination machine.</p>
<h3 id="the-path-to-the-disk-were-going-to-write-the-image-onto">The path to the disk we&rsquo;re going to write the image onto</h3>
<p>To find the path to the disk, run:</p>
<pre><code>parted -l
</code></pre><p>You&rsquo;ll see something like this:</p>
<pre><code>Model: SAMSUNG MZVLB256HAHQ-000L7 (nvme)
Disk /dev/nvme0n1: 256GB
Sector size (logical/physical): 512B/512B
Partition Table: msdos
Disk Flags:

Number  Start   End     Size    Type     File system  Flags
 1      1049kB  1075MB  1074MB  primary  ext4         boot
 2      1075MB  256GB   255GB   primary
</code></pre><p>The bit we&rsquo;re looking for is on the second line, <code>/dev/nvme0n1</code>.  If multiple disks appear, make sure to choose the right one.</p>
<p>Put it into an environment variable.</p>
<pre><code>export DEST_DISK=&quot;/dev/nvme0n1&quot;
</code></pre><p>The last step for the destination machine is to open the door and wait for the image to be sent.</p>
<pre><code>nc -l 1234 | dd bs=16M of=$DEST_DISK status=progress
</code></pre><p>This starts a netcat server listening on port 1234.  It then pipes any data sent to the netcat server directly onto the disk.  Now we just need to send the data.</p>
<hr>
<h2 id="step-3-send-the-image-from-the-source-machine">Step 3. Send the image from the source machine</h2>
<p>On the source machine, we only need one piece of information: the path to the disk.  Use the same <code>parted -l</code> command from above to find it.  On my system, it was <code>/dev/nvme0n1</code>.  As before, save this in a variable.</p>
<pre><code>export SOURCE_DISK=/dev/nvme0n1
</code></pre><p>The final step.  This command will send every bit from the source machine&rsquo;s disk across the network to the destination machine, where the waiting netcat server will write it to the destination machine&rsquo;s disk.</p>
<p>This would be a good point to stop and make sure you understand every step thus far and (above all) make sure you&rsquo;re writing this data to the correct disk.  When you&rsquo;re ready:</p>
<pre><code>dd bs=16M if=$SOURCE_DISK | nc $DEST_IP 1234
</code></pre><p>The destination machine will begin displaying statistics about the data as it streams in.</p>
<hr>
<h2 id="step-4-rejoice">Step 4. Rejoice</h2>
<p>On my 256 gig disk, this ran at about 88 MiB/s, roughly 75% of the theoretical max for a 1 Gbps network.  It took only 48 minutes to complete.</p>
<p><img src="./complete.jpg" alt="image of the console after transfer completes"></p>
<p>Having nearly saturated the network, I&rsquo;m quite sure this was the fastest way I could have cloned the disk using generalized tools.  I&rsquo;m sure there are faster ways with specialized hardware or software, but who has time for that?  I do wonder whether using compression would have increased the overall speed, or instead created a new CPU/RAM bottleneck.</p>
<p>Happy cloning.</p>

  </section>
  <footer>

    

    

    

<section>
  <h3>RELATED POSTS</h3>
  <div class="pbp-related">
    
    <article class="pbp-article-li vertical">
  <h2 class="pbp-article-title"><a href="https://clayto.com/2017/10/noise/echo-cancellation-in-fedora/">Noise/Echo Cancellation in Fedora</a></h2>
  <div class="pbp-article-summary">
    <section>
      
        How to enable PulseAudio noise and echo cancellation in Fedora 26-29.
      
    </section>
  </div>
  <div class="pbp-article-meta">
    <time datetime="2017-10-12T00:00:00Z">
      Oct 12, 2017
    </time>
  </div>
  
  <a tabindex="-1" class="pbp-article-thumbnail" href="https://clayto.com/2017/10/noise/echo-cancellation-in-fedora/">
    <div class="pbp-article-thumbnail">
      <div class="glass-card">
        <div class="glass-card-ratio">
          <picture>
            
            
            
               
            
            <img
              class="glass-card-bg glass-card-bg-default"
              src="https://clayto.com/2017/10/noise/echo-cancellation-in-fedora/./after.jpg">
          </picture>
          <div class="glass-card-border-outer"></div>
          <div class="glass-card-border-inner"></div>
          
          
          
          
          
        </div>
      </div>
    </div>
  </a>
  
</article>

    
    
  </div>
</section>




  </footer>
</article>
  </main>
  <footer class="container">
    <section class="pbp-footer">
      
<aside>
  
    <small class="footer-label">CONTACT ME</small>
    
    
    
    
<ul class="pbp-social-links">
  
  <li>
    <a title="Email me" href="mailto:mwc@clayto.com">
      <span class="icon-mail"></span>
    </a>
  </li>
  
  
  <li>
    <a title="my GitHub activity" href="https://github.com/mwcz" target="_blank">
      <span class="icon-github-squared"></span>
    </a>
  </li>
  
  
  <li>
    <a title="my CodePens" href="https://codepen.io/mwcz" target="_blank">
      <span class="icon-codepen"></span>
    </a>
  </li>
  
  
  <li>
    <a title="my Twitter" href="https://twitter.com/mwcz" target="_blank">
      <span class="icon-twitter-squared"></span>
    </a>
  </li>
  
  
  
  
  
  
  
  
  
  
  
  
  <li>
    <a title="my Vimeo videos" href="https://vimeo.com/mwcz" target="_blank">
      <span class="icon-vimeo-squared"></span>
    </a>
  </li>
  
  
  
</ul>


  
</aside>


    </section>

    
    
    
    
    

    
    
    
    
    
    
  </footer>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/4.3.0/anchor.min.js"></script>
  <script>
    anchors.options.visible = 'touch';
    anchors.options.placement = 'right';
    anchors.options.class = 'heading-anchor';
    anchors.add('article > section h1,article > section h2,article > section h3,article > section h4,article > section h5,article > section h6');
  </script>

  
    
  

</body>
</html>

